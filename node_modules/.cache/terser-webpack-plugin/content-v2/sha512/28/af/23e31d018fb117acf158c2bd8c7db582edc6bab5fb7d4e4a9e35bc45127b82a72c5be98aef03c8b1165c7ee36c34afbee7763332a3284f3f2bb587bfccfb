{"code":"!function(e){var t={};function i(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,\"a\",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p=\"\",i(i.s=0)}([function(e,t){!function(e){var t=window.AporiaPlaylist={start:function(i){this.data=i,this.players=new this.Collections.Players(i.players),delete this.data.players,e(\"body > div:first-child\").wrapAll('<section id=\"mejs-body-container\" />');var n=wp.template(\"wp-playlist-panel\");e(\"#mejs-body-container\").after(n()),this.view=new this.Views.Players({collection:this.players}),this.view=new this.Views.Playlist({id:\"mejs-player-panel\",model:new t.Models.Playlist,collection:this.players})}};function i(){var t=[],i=aporia_audio_player.audio_selector?aporia_audio_player.audio_selector:\"audio.wp-audio-shortcode\";console.log(\"using selector: \"+i);var n=e(i);n.length;return n.length&&n.each(function(){var i=e(this),n=e(this).closest(\".mejs-container\");n.addClass(\"hidden\");var a,s,r,l=i.attr(\"src\").replace(/_=[0-9]+/,\"\").replace(/\\?$/,\"\"),o=i.getTitle(),c=i.attr(\"type\"),u=i.getDescription().replace(/(<([^>]+)>)/gi,\"\"),p=\"ap_\"+(a=l,crypto.createHash(s||\"md5\").update(a,\"utf8\").digest(r||\"hex\"));console.log(p),t.push({id:p,src:l,type:c,title:o,caption:\"\",description:u}),n.before('<div id=\"'+p+'\" class=\"ap-container\"/>')}),e(\".mejs-container\").not(\".hidden\").show(),t}t.View=wp.Backbone.View.extend({inject:function(e){this.render(),this.views.ready()},prepare:function(){return!_.isUndefined(this.model)&&_.isFunction(this.model.toJSON)?this.model.toJSON():{}}}),t.Model=Backbone.Model.extend({toggle:function(e,t){return t=t?_.clone(t):{},this.set(e,!this.get(e),t)}}),t.Models={},t.Models.Player=t.Model.extend({defaults:{id:\"\",src:\"\",type:\"\",title:\"\",caption:\"\",description:\"\",artists:!0,tracknumbers:!0,meta:{},active:!1,playing:!1,currentTime:0},localStorage:new Backbone.LocalStorage(\"audio-player\"),initialize:function(){this.on(\"change\",this.storeData)},storeData:function(e,t,i){this.save()},makeActive:function(e){this.set(\"active\",!0,e)},makeInactive:function(e){this.set(\"active\",!1,e)},play:function(e){this.set(\"playing\",!0,e)},pause:function(e){this.set(\"playing\",!1,e)},getMEPID:function(){return\"mep_\"+this.collection.indexOf(this)},getMEPProperty:function(e){if(e){var t=this.getMEPID();mejs.players[t];return mejs.players[t][e]}},updatingCurrentTime:function(){console.log(\"updating cT: \"+this.get(\"currentTime\"))}}),t.Models.Playlist=t.Model.extend({defaults:{id:\"\",type:\"audio\",minimised:!1,tracklist:!0,tracks:[],scrubbing:!1,scrubbedToCurrentTime:\"\",autoplay:!0},localStorage:new Backbone.LocalStorage(\"audio-playlist\"),initialize:function(){this.on(\"change\",this.storeData)},storeData:function(e,t,i){this.save()},isScrubbing:function(e,t,i){console.log(\"scrubbing: \"+this.get(\"scrubbing\"))},showScrubbedTime:function(e,t,i){console.log(\"scrubbedToCurrentTime: \"+this.get(\"scrubbedToCurrentTime\"))}}),t.Collections={},t.Collections.Players=Backbone.Collection.extend({model:t.Models.Player,initialize:function(){this.on(\"change:active\",this.changeActive),this.on(\"change:playing\",this.changePlaying)},changeActive:function(e,t,i){t&&this.each(function(t){t!=e&&t.get(\"active\")&&t.makeInactive()})},changePlaying:function(e,t,i){t&&this.each(function(t){t!=e&&t.get(\"playing\")&&t.pause()})},getCurrentPlayer:function(){var e=!1;return _.each(this.models,function(t){t.get(\"active\")&&(e=t)}),e}}),t.Views={},t.Views.Player=t.View.extend({className:\"ap-container\",initialize:function(){this.model.fetch(),this.model.set(\"currentTime\",this.model.get(\"currentTime\")-2),this.model.storeData(),this.listenTo(this.model,\"change:active\",this.render),this.listenTo(this.model,\"change:playing\",this.render);var t=wp.template(\"audio-player-circle-play-pause-button\"),i=e('<div class=\"player-button play-button light\"></div>');i.append(t),this.$el.append(i),this.render()},events:{\"click .player-button.play-button\":\"clickPlay\",\"click .player-button.pause-button\":\"clickPause\"},clickPlay:function(){this.model.makeActive(),this.model.play()},clickPause:function(){this.model.pause()},renderPlay:function(e){this.$el.find(\".player-button\").removeClass(\"play-button\").addClass(\"pause-button\")},renderPause:function(e){this.$el.find(\".player-button\").removeClass(\"pause-button\").addClass(\"play-button\")},render:function(){var e=this.$el.closest(\"article\");e.addClass(\"has-audio-player\"),this.model.get(\"active\")?e.removeClass(\"inactive-player\").addClass(\"active-player\"):e.removeClass(\"active-player\").addClass(\"inactive-player\"),this.model.get(\"playing\")&&this.model.get(\"active\")?this.renderPlay():this.renderPause(),this.controlMEP()},controlMEP:function(){var e=this,t=this.model.getMEPID();if(this_mejs_player=mejs.players[t],this_mejs_player.setCurrentTime(this.model.get(\"currentTime\")),this.model.get(\"playing\")&&this_mejs_player.paused){var i=this_mejs_player.play();void 0!==i&&i.then(function(e){console.log(\"no problem with autoplay\")}).catch(function(t){e.renderPause(),console.log(\"problem with autoplay\")})}this.model.get(\"playing\")||this_mejs_player.paused||this_mejs_player.pause()}}),t.Views.Playlist=t.View.extend({el:\"#mejs-player-panel\",initialize:function(t){this.model=t.model,this.tracks=t.collection,this.model.fetch(),this.model.save(),this.index=0,this.settings={},this.listenTo(this.tracks,\"change:active, change:playing\",this.render),this.listenTo(this.tracks,\"change:currentTime\",this.renderCurrent);var i=wp.template(\"audio-player-play-pause-button\"),n=e('<div class=\"play-pause-button aap-button play-button\"></div>');n.append(i),e(\"#main-player .left-side\").prepend(n);var a=wp.template(\"audio-player-close-expand-button\"),s=e('<div class=\"close-expand-button opened aap-button highlighted\"></div>');s.append(a),e(\"#main-player .left-side\").prepend(s);var r=wp.template(\"audio-player-back15s-button\"),l=e('<div class=\"skip-back-button aap-button\"></div>');l.append(r),e(\"#main-player .left-side\").append(l);var o=wp.template(\"audio-player-skip15s-button\"),c=e('<div class=\"skip-forward-button aap-button\"></div>');c.append(o),e(\"#main-player .left-side\").append(c);var u=wp.template(\"audio-player-previous-button\"),p=e('<div class=\"prev-button aap-button\"></div>');p.append(u),e(\"#main-player .left-side\").append(p);var d=wp.template(\"audio-player-next-button\"),h=e('<div class=\"next-button aap-button\"></div>');h.append(d),e(\"#main-player .left-side\").append(h),this.playerNode=e(this.model.get(\"type\"));var y=wp.template(\"audio-player-play-pause-button\"),m=e('<div class=\"large-button player-button play-button\"></div>');m.append(y),e(\"#main-player .right-side\").append(m),this.model.get(\"tracklist\")&&(this.itemTemplate=wp.template(\"wp-playlist-item\"),this.playingClass=\"wp-playlist-playing\",this.renderTracks()),this.render(),this.bindMediaElement(),this.model.get(\"minimised\")?this.hidePlayer():this.showPlayer(),this.isPlaying()},addTrackView:function(e){this.views.add(new t.Views.Track({id:e.id}))},events:{\"click .close-expand-button\":\"togglePlayer\",\"click .wp-playlist-item\":\"clickTrack\",\"click .player-button.play-button\":\"clickPlay\",\"click .player-button.pause-button\":\"clickPause\",\"click .play-pause-button.play-button\":\"clickPlay\",\"click .play-pause-button.pause-button\":\"clickPause\",\"click .skip-back-button\":\"clickSkipBack\",\"click .skip-forward-button\":\"clickSkipForward\",\"click .prev-button\":\"prevTrack\",\"click .next-button\":\"nextTrack\",\"mousedown .player-timeline svg\":\"startScrubbing\",\"touchstart .player-timeline svg\":\"startScrubbing\",\"mousemove .player-timeline svg\":\"captureScrubbing\",\"touchmove .player-timeline svg\":\"captureScrubbing\",\"mouseup .player-timeline svg\":\"stopScrubbing\",\"startend .player-timeline svg\":\"stopScrubbing\"},bindMediaElement:function(){var t=this,i=this.current.getMEPID(),n=e(\"#\"+i+\" audio\"),a=mejs.players[i];e(\"mejs-container audio\").off(\"timeupdate\"),e(\"mejs-container audio\").off(\"ended\"),a.setCurrentTime(this.current.get(\"currentTime\")),n.off(\"timeupdate\").on(\"timeupdate\",function(){if(!t.model.get(\"scrubbing\")){var e=a.getCurrentTime();t.current.set(\"currentTime\",e)}}),n.off(\"ended\").on(\"ended\",function(e){t.trackEnded(e)})},startScrubbing:function(e){console.log(\"touchstart\"),this.model.set(\"scrubbing\",!0);var t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];console.log(t.pageX),this.captureScrubbing(e)},captureScrubbing:function(t){if(this.model.get(\"scrubbing\")){var i=t.target;if(e(i).hasClass(\"baseline\")||(i=e(i).parents(\".player-timeline\").find(\".baseline\").get(0)),null!=i){t.touches&&(this.touchobj=t.touches[0]);var n=e(i).parents(\".player-timeline\"),a=(this.current.get(\"currentTime\"),this.current.getMEPProperty(\"duration\")),s=i.getBoundingClientRect();if(this.touchobj){console.log(touchobj[0]);var r=this.touchobj.clientX-s.left,l=this.touchobj.clientY-s.top}else r=t.clientX-s.left,l=t.clientY-s.top;if(!isNaN(r)&&!isNaN(l)){var o=i.getTotalLength();i.getBoundingClientRect().height;if(\"circle_timeline\"==n.attr(\"id\")){var c=s.height/2,u=2*Math.PI*c,p=r-c,d=l-c,h=Math.atan2(d,p)+Math.PI/2;h<0&&(h+=2*Math.PI);var y=h*c,m=y/u*o,g=y/u*a;n.find(\".mainline\").attr(\"stroke-dasharray\",m+\" \"+o)}else if(\"horizontal_timeline\"==n.attr(\"id\")){g=(f=r)/s.width*a;n.find(\".mainline\").attr(\"stroke-dasharray\",f+\" \"+s.width)}else{var f;g=(f=l)/s.height*a;n.find(\".mainline\").attr(\"stroke-dasharray\",f+\" \"+s.height)}this.model.set(\"scrubbedToCurrentTime\",g)}}}},stopScrubbing:function(e){console.log(\"touchend\"),this.updatePlayer(),this.model.set(\"scrubbing\",!1)},updatePlayer:function(e){var t=this.current.getMEPID();this_mejs_player=mejs.players[t];var i=this.current.get(\"playing\");this_mejs_player.pause(),this_mejs_player.setCurrentTime(this.model.get(\"scrubbedToCurrentTime\")),i&&this_mejs_player.play(),this.renderTimeline()},clickPlay:function(){this.current&&(this.current.makeActive(),this.current.play())},clickPause:function(){this.current&&this.current.pause()},clickSkipBack:function(){if(this.current){var e=this.current.getMEPID(),t=mejs.players[e];currentTime=t.getCurrentTime(),t.setCurrentTime(currentTime-15)}},clickSkipForward:function(){if(this.current){var e=this.current.getMEPID(),t=mejs.players[e];currentTime=t.getCurrentTime(),t.setCurrentTime(currentTime+15)}},trackEnded:function(t){this.current.getMEPID()==e(t.target).parents(\".mejs-container\").attr(\"id\")&&(this.current.pause(),this.current.set(\"currentTime\",0),t.target.setCurrentTime(-1),this.model.autoplay&&this.current.play(),this.nextTrack())},prevTrack:function(){var e=this.current.get(\"playing\");this.current.pause(),this.index=this.index-1<0?this.tracks.length-1:this.index-1,this.setCurrent(this.index),this.scrollToTrack(),e&&this.current.play()},nextTrack:function(){var e=this.current.get(\"playing\");this.current.pause(),this.index=this.index+1>=this.tracks.length?0:this.index+1,this.setCurrent(this.index),this.scrollToTrack(),e&&this.current.play()},scrollToTrack:function(){var t=e(\".wp-playlist-tracks-wrapper\"),i=e(\".wp-playlist-item.wp-playlist-playing\"),n=t.scrollTop()+(i.offset().top-t.offset().top);e(\".wp-playlist-tracks-wrapper\").animate({scrollTop:n},1e3)},isPlaying:function(){this.setCurrent()},togglePlayer:function(){e(\"body\").hasClass(\"expanded-playlist-player\")?(e(\".close-expand-button\").removeClass(\"opened\").addClass(\"closed\"),this.hidePlayer()):(e(\".close-expand-button\").removeClass(\"closed\").addClass(\"opened\"),this.showPlayer())},showPlayer:function(){this.model.set(\"minimised\",!1),e(\"body\").addClass(\"expanded-playlist-player\").removeClass(\"minimized-playlist-player\")},hidePlayer:function(){this.model.set(\"minimised\",!0),e(\"body\").addClass(\"minimized-playlist-player\").removeClass(\"expanded-playlist-player\")},clickTrack:function(t){t.preventDefault(),this.previous_index=this.index,this.index=this.$(\".wp-playlist-item\").index(t.currentTarget),this.current=this.tracks.at(this.index),this.current.makeActive(),e(\".wp-playlist-tracks-wrapper\").animate({scrollTop:jQuery(\".wp-playlist-item.wp-playlist-playing\").offset().top},1e3),this.current.get(\"playing\")?this.current.pause():this.current.play(),document.title=this.current.get(\"title\"),console.log(document.title)},bindPlayer:function(e){console.log(\"bindPlayer\"),this.mejs=e,this.mejs.addEventListener(\"ended\",this.ended)},bindResetPlayer:function(e){console.log(\"bindResetPlayer\"),this.bindPlayer(e)},setCurrent:function(e){var t=this.current;e||(this.current=this.tracks.getCurrentPlayer(),this.current||-1==this.index&&(this.index=0)),this.current=this.tracks.at(this.index),this.current.makeActive(),this.bindMediaElement(),t!==this.current&&this.renderCurrent()},renderTimeline:function(){if(!this.model.get(\"scrubbing\")){var t=this.current.get(\"currentTime\"),i=this.current.getMEPID(),n=(mejs.players[i],this.current.getMEPProperty(\"duration\")),a=this.current.getMEPProperty(\"buffered\"),s=this.formatTime(t),r=this.formatTime(n-t);e(\"#circle_timeline .elapsed textPath, .timelines .elapsed\").text(s),e(\"#circle_timeline .remaining textPath, .timelines .remaining\").text(r),e(\".player-timeline\").each(function(){var i=e(this).find(\".baseline\"),s=e(this).find(\".mainline\");if(null!=i.get(0)){var r=i.get(0).getTotalLength(),l=t/n*r;if(l&&s.attr(\"stroke-dasharray\",l+\" \"+r),a){var o=e(this).find(\".bufferline\"),c=a/n*r;o.attr(\"stroke-dasharray\",c+\" \"+r)}}}),this.current.storeData()}},renderCurrent:function(){if(this.current=this.tracks.getCurrentPlayer(),this.index=this.tracks.indexOf(this.current),this.current){e(\".wp-playlist-item\").find(\".player-button\").removeClass(\"dark\").addClass(\"light\"),this.model.get(\"tracklist\")&&this.$(\".wp-playlist-item\").removeClass(this.playingClass).eq(this.index).addClass(this.playingClass).find(\".player-button\").removeClass(\"light\").addClass(\"dark\"),this.$(\".wp-playlist-item\").find(\".player-button\").removeClass(\"pause-button\").addClass(\"play-button\");var t=this.$(\".wp-playlist-item\").eq(this.index);this.current.get(\"playing\")?t.find(\".player-button\").removeClass(\"play-button\").addClass(\"pause-button\"):t.find(\".player-button\").removeClass(\"pause-button\").addClass(\"play-button\"),this.renderTimeline()}},formatTime:function(e){if(isFinite(e))t=mejs.Utils.secondsToTimeCode(parseInt(e));else var t=\"unknown\";return t},renderTracks:function(){var t=this,i=this.$el.find(\".wp-playlist-tracks\");i.html(\"\"),_.each(this.tracks.models,function(e){i.append(t.itemTemplate(e.toJSON())),1});var n=wp.template(\"audio-player-circle-play-pause-button\"),a=e('<div class=\"player-button light play-button\"></div>');a.append(n),this.$(\".wp-playlist-item\").prepend(a)},renderButton:function(){this.current&&(this.current.get(\"playing\")?this.$el.find(\"#main-player .play-button\").removeClass(\"play-button\").addClass(\"pause-button\"):this.$el.find(\"#main-player .pause-button\").removeClass(\"pause-button\").addClass(\"play-button\"))},render:function(){this.setCurrent(),this.renderButton(),this.renderCurrent()}}),t.Views.Track=t.View.extend({className:\"wp-playlist-item\"}),t.Views.Players=t.View.extend({id:\"mejs-body-container\",initialize:function(){_.each(this.collection.models,this.addPlayerView,this)},addPlayerView:function(i){var n=e(\"#\"+i.id);new t.Views.Player({el:n,model:i})},render:function(){console.log(\"Players render\")}}),e(\"article\").on(\"playing\",function(e){e.preventDefault(),console.log(\"playing event\")}),e(\"article\").on(\"paused\",function(e){e.preventDefault(),console.log(\"paused event\")}),e.fn.getTitle=function(){var t=e(this).closest(\"article\").find(\"h1,h2,h3\");return t.find(\"a\").length?t.find(\"a\").html().trim():t.html().trim()},e.fn.getDescription=function(){return e(this).closest(\"article\").find(\"p\").length?e(this).closest(\"article\").find(\"p\").html().trim():\"\"},e(document).ready(function(){setTimeout(function(){var e=i();e.length&&AporiaPlaylist.start({players:e})},100)})}(jQuery)}]);","extractedComments":[]}